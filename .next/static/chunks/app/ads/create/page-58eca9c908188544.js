(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[340],{255:(e,r,t)=>{"use strict";function a(e){let{moduleIds:r}=e;return null}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"PreloadChunks",{enumerable:!0,get:function(){return a}}),t(5155),t(7650),t(5744),t(589)},1359:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>b});var a=t(5155),n=t(2115),o=t(5695),i=t(3475),l=t(851),s=t(9946);let c=(0,s.A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var d=t(4416);let u=(0,s.A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var m=t(3568),g=t(5028),p=t(6874),h=t.n(p);let y=(0,g.default)(()=>Promise.all([t.e(484),t.e(761),t.e(519)]).then(t.bind(t,4519)),{loadableGenerated:{webpack:()=>[4519]},ssr:!1}),f=(0,l.UU)("https://zvyuurbieuionummrcqi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2eXV1cmJpZXVpb251bW1yY3FpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4NDA0MTIsImV4cCI6MjA1ODQxNjQxMn0.IKZgwRcmGPhYHDuvkRAco9lWk5GXjAT568ZD3XmodEU"),x=["image/jpeg","image/png","image/gif"];function b(){let e=(0,o.useRouter)(),{user:r}=(0,i.A)(),[t,l]=(0,n.useState)(!1),[s,g]=(0,n.useState)([]),[p,b]=(0,n.useState)([]),[j,v]=(0,n.useState)([]),[w,k]=(0,n.useState)(null),[N,P]=(0,n.useState)({}),[I,_]=(0,n.useState)(null),[C,A]=(0,n.useState)({title:"",description:"",price:"",currency:"EUR",category_id:"",location:"",negotiable:!1,condition:"new",tags:[]});(0,n.useEffect)(()=>{O(),S()},[]);let S=async()=>{try{let{data:e,error:t}=await f.from("profiles").select("*").eq("id",r.id).single();if(t)throw t;k(e)}catch(e){console.error("Error fetching user profile:",e)}},O=async()=>{try{let{data:e,error:r}=await f.from("categories").select("*").order("name");if(r)throw r;g(e)}catch(e){console.error("Error fetching categories:",e)}},R=()=>{let e={};return C.title.length<10&&(e.title="Title must be at least ".concat(10," characters")),C.description.length<30&&(e.description="Description must be at least ".concat(30," characters")),C.category_id||(e.category="Please select a category"),C.location||(e.location="Please enter a location"),p.length||(e.images="Please upload at least one image"),I||(e.coordinates="Please select a location on the map"),P(e),0===Object.keys(e).length},E=async t=>{if(t.preventDefault(),!R()){m.oR.error("Please fix the validation errors");return}l(!0);try{let t=await Promise.all(p.map(async e=>{let t=e.name.split(".").pop(),a="".concat(Math.random(),".").concat(t),n="".concat(r.id,"/").concat(a),{error:o}=await f.storage.from("ad-images").upload(n,e);if(o)throw o;let{data:{publicUrl:i}}=f.storage.from("ad-images").getPublicUrl(n);return i})),{data:a,error:n}=await f.from("ads").insert([{...C,user_id:r.id,image_urls:t,main_image_url:t[0],price:parseFloat(C.price),coordinates:"POINT(".concat(I.lng," ").concat(I.lat,")")}]).select().single();if(n)throw n;"active"===a.status?m.oR.success("Your ad has been automatically approved and is now live!"):m.oR.success("Your ad has been submitted and is pending review."),e.push("/dashboard")}catch(e){console.error("Error creating ad:",e),m.oR.error("Error creating ad. Please try again.")}finally{l(!1)}},M=e=>{let{name:r,value:t}=e.target;A(e=>({...e,[r]:t}))};return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Create New Ad"}),!(null==w?void 0:w.phone)&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(c,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Verification Recommended"}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-yellow-700",children:["Verify your phone number to increase trust and get your ads approved faster."," ",(0,a.jsx)(h(),{href:"/profile",className:"font-medium underline",children:"Verify now"})]})]})]})}),(0,a.jsxs)("form",{onSubmit:E,className:"max-w-2xl space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Ad Image"}),(0,a.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg",children:(0,a.jsx)("div",{className:"space-y-1 text-center",children:j.length>0?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:j[0],alt:"Preview",className:"mx-auto h-48 w-48 object-cover rounded-lg"}),(0,a.jsx)("button",{type:"button",onClick:()=>{b([]),v([])},className:"absolute top-2 right-2 p-1 bg-white/90 dark:bg-gray-900/90 rounded-full hover:bg-white dark:hover:bg-gray-900 transition-colors",children:(0,a.jsx)(d.A,{className:"w-5 h-5"})})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)(u,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,a.jsxs)("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[(0,a.jsxs)("label",{htmlFor:"image-upload",className:"relative cursor-pointer rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none focus-within:ring-2 focus-within:ring-primary focus-within:ring-offset-2",children:[(0,a.jsx)("span",{children:"Upload a file"}),(0,a.jsx)("input",{id:"image-upload",name:"image-upload",type:"file",className:"sr-only",accept:"image/*",onChange:e=>{let r=Array.from(e.target.files).filter(e=>x.includes(e.type)?!(e.size>0xa00000)||(m.oR.error("".concat(e.name," is too large (max 10MB)")),!1):(m.oR.error("".concat(e.name," is not a supported image type")),!1));r.length&&(b(e=>[...e,...r]),r.forEach(e=>{let r=new FileReader;r.onloadend=()=>{v(e=>[...e,r.result])},r.readAsDataURL(e)}))},multiple:!0})]}),(0,a.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF up to 10MB"})]})})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Title"}),(0,a.jsx)("input",{type:"text",id:"title",name:"title",required:!0,value:C.title,onChange:M,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),(0,a.jsx)("textarea",{id:"description",name:"description",required:!0,rows:4,value:C.description,onChange:M,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Price"}),(0,a.jsx)("input",{type:"number",id:"price",name:"price",required:!0,min:"0",step:"0.01",value:C.price,onChange:M,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Currency"}),(0,a.jsxs)("select",{id:"currency",name:"currency",required:!0,value:C.currency,onChange:M,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700",children:[(0,a.jsx)("option",{value:"USD",children:"USD"}),(0,a.jsx)("option",{value:"EUR",children:"EUR"}),(0,a.jsx)("option",{value:"GBP",children:"GBP"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"category_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),(0,a.jsxs)("select",{id:"category_id",name:"category_id",required:!0,value:C.category_id,onChange:M,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700",children:[(0,a.jsx)("option",{value:"",children:"Select a category"}),s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Location"}),(0,a.jsx)("input",{type:"text",id:"location",name:"location",required:!0,value:C.location,onChange:M,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Condition"}),(0,a.jsxs)("select",{name:"condition",value:C.condition,onChange:M,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg",children:[(0,a.jsx)("option",{value:"new",children:"New"}),(0,a.jsx)("option",{value:"like-new",children:"Like New"}),(0,a.jsx)("option",{value:"good",children:"Good"}),(0,a.jsx)("option",{value:"fair",children:"Fair"}),(0,a.jsx)("option",{value:"poor",children:"Poor"})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"negotiable",name:"negotiable",checked:C.negotiable,onChange:e=>A(r=>({...r,negotiable:e.target.checked})),className:"h-4 w-4 text-primary border-gray-300 rounded"}),(0,a.jsx)("label",{htmlFor:"negotiable",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Price is negotiable"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Location on Map"}),(0,a.jsx)("div",{className:"h-[300px] rounded-lg overflow-hidden",children:(0,a.jsx)(y,{onLocationSelect:_})}),N.coordinates&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.coordinates})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:t,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",children:t?"Creating...":"Create Ad"})})]})]})}},2146:(e,r,t)=>{"use strict";function a(e){let{reason:r,children:t}=e;return t}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"BailoutToCSR",{enumerable:!0,get:function(){return a}}),t(5262)},3475:(e,r,t)=>{"use strict";t.d(r,{A:()=>s,AuthProvider:()=>l});var a=t(5155),n=t(2115),o=t(851);let i=(0,n.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,n.useState)(null),[s,c]=(0,n.useState)(!0),d=(0,o.UU)("https://zvyuurbieuionummrcqi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2eXV1cmJpZXVpb251bW1yY3FpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4NDA0MTIsImV4cCI6MjA1ODQxNjQxMn0.IKZgwRcmGPhYHDuvkRAco9lWk5GXjAT568ZD3XmodEU");(0,n.useEffect)(()=>{let{data:{subscription:e}}=d.auth.onAuthStateChange((e,r)=>{l((null==r?void 0:r.user)||null),c(!1)});return d.auth.getSession().then(e=>{let{data:{session:r}}=e;l((null==r?void 0:r.user)||null),c(!1)}),()=>{null==e||e.unsubscribe()}},[d]);let u=async(e,r)=>{let{error:t}=await d.auth.signInWithPassword({email:e,password:r});return{error:t}},m=async(e,r)=>{let{error:t}=await d.auth.signUp({email:e,password:r});return{error:t}},g=async()=>{let{error:e}=await d.auth.signOut();return{error:e}};return(0,a.jsx)(i.Provider,{value:{user:t,loading:s,signIn:u,signUp:m,signOut:g,supabase:d},children:r})}function s(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4054:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{bindSnapshot:function(){return i},createAsyncLocalStorage:function(){return o},createSnapshot:function(){return l}});let t=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class a{disable(){throw t}getStore(){}run(){throw t}exit(){throw t}enterWith(){throw t}static bind(e){return e}}let n="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function o(){return n?new n:new a}function i(e){return n?n.bind(e):a.bind(e)}function l(){return n?n.snapshot():function(e,...r){return e(...r)}}},4416:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(9946).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5028:(e,r,t)=>{"use strict";t.d(r,{default:()=>n.a});var a=t(6645),n=t.n(a)},5695:(e,r,t)=>{"use strict";var a=t(8999);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},5744:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"workAsyncStorage",{enumerable:!0,get:function(){return a.workAsyncStorageInstance}});let a=t(7828)},6463:(e,r,t)=>{Promise.resolve().then(t.bind(t,1359))},6645:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return n}});let a=t(8229)._(t(7357));function n(e,r){var t;let n={};"function"==typeof e&&(n.loader=e);let o={...n,...r};return(0,a.default)({...o,modules:null==(t=o.loadableGenerated)?void 0:t.modules})}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),e.exports=r.default)},7357:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s}});let a=t(5155),n=t(2115),o=t(2146);function i(e){return{default:e&&"default"in e?e.default:e}}t(255);let l={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},s=function(e){let r={...l,...e},t=(0,n.lazy)(()=>r.loader().then(i)),s=r.loading;function c(e){let i=s?(0,a.jsx)(s,{isLoading:!0,pastDelay:!0,error:null}):null,l=!r.ssr||!!r.loading,c=l?n.Suspense:n.Fragment,d=r.ssr?(0,a.jsxs)(a.Fragment,{children:[null,(0,a.jsx)(t,{...e})]}):(0,a.jsx)(o.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(t,{...e})});return(0,a.jsx)(c,{...l?{fallback:i}:{},children:d})}return c.displayName="LoadableComponent",c}},7828:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"workAsyncStorageInstance",{enumerable:!0,get:function(){return a}});let a=(0,t(4054).createAsyncLocalStorage)()},9946:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var a=t(2115);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)((e,r)=>{let{color:t="currentColor",size:n=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:c="",children:d,iconNode:u,...m}=e;return(0,a.createElement)("svg",{ref:r,...i,width:n,height:n,stroke:t,strokeWidth:s?24*Number(l)/Number(n):l,className:o("lucide",c),...m},[...u.map(e=>{let[r,t]=e;return(0,a.createElement)(r,t)}),...Array.isArray(d)?d:[d]])}),s=(e,r)=>{let t=(0,a.forwardRef)((t,i)=>{let{className:s,...c}=t;return(0,a.createElement)(l,{ref:i,iconNode:r,className:o("lucide-".concat(n(e)),s),...c})});return t.displayName="".concat(e),t}}},e=>{var r=r=>e(e.s=r);e.O(0,[112,568,441,684,358],()=>r(6463)),_N_E=e.O()}]);