(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[340],{1263:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>b});var t=a(5155),s=a(2115),i=a(5695),o=a(4785),n=a(851),l=a(5339),c=a(4416),d=a(9869),u=a(3568),m=a(5028),g=a(6874),x=a.n(g);let p=(0,m.default)(()=>Promise.all([a.e(484),a.e(761),a.e(519)]).then(a.bind(a,4519)),{loadableGenerated:{webpack:()=>[4519]},ssr:!1}),h=(0,n.UU)("https://zvyuurbieuionummrcqi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2eXV1cmJpZXVpb251bW1yY3FpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4NDA0MTIsImV4cCI6MjA1ODQxNjQxMn0.IKZgwRcmGPhYHDuvkRAco9lWk5GXjAT568ZD3XmodEU"),y=["image/jpeg","image/png","image/gif"];function b(){let e=(0,i.useRouter)(),{user:r}=(0,o.A)(),[a,n]=(0,s.useState)(!1),[m,g]=(0,s.useState)([]),[b,f]=(0,s.useState)([]),[j,v]=(0,s.useState)([]),[w,N]=(0,s.useState)(null),[k,I]=(0,s.useState)({}),[C,P]=(0,s.useState)(null),[S,A]=(0,s.useState)({title:"",description:"",price:"",currency:"EUR",category_id:"",location:"",negotiable:!1,condition:"new",tags:[]});(0,s.useEffect)(()=>{F(),R()},[]);let R=async()=>{try{let{data:e,error:a}=await h.from("profiles").select("*").eq("id",r.id).single();if(a)throw a;N(e)}catch(e){console.error("Error fetching user profile:",e)}},F=async()=>{try{let{data:e,error:r}=await h.from("categories").select("*").order("name");if(r)throw r;g(e)}catch(e){console.error("Error fetching categories:",e)}},E=()=>{let e={};return S.title.length<10&&(e.title="Title must be at least ".concat(10," characters")),S.description.length<30&&(e.description="Description must be at least ".concat(30," characters")),S.category_id||(e.category="Please select a category"),S.location||(e.location="Please enter a location"),b.length||(e.images="Please upload at least one image"),C||(e.coordinates="Please select a location on the map"),I(e),0===Object.keys(e).length},J=async a=>{if(a.preventDefault(),!E()){u.oR.error("Please fix the validation errors");return}n(!0);try{let a=await Promise.all(b.map(async e=>{let a=e.name.split(".").pop(),t="".concat(Math.random(),".").concat(a),s="".concat(r.id,"/").concat(t),{error:i}=await h.storage.from("ad-images").upload(s,e);if(i)throw i;let{data:{publicUrl:o}}=h.storage.from("ad-images").getPublicUrl(s);return o})),{data:t,error:s}=await h.from("ads").insert([{...S,user_id:r.id,image_urls:a,main_image_url:a[0],price:parseFloat(S.price),coordinates:"POINT(".concat(C.lng," ").concat(C.lat,")")}]).select().single();if(s)throw s;"active"===t.status?u.oR.success("Your ad has been automatically approved and is now live!"):u.oR.success("Your ad has been submitted and is pending review."),e.push("/dashboard")}catch(e){console.error("Error creating ad:",e),u.oR.error("Error creating ad. Please try again.")}finally{n(!1)}},U=e=>{let{name:r,value:a}=e.target;A(e=>({...e,[r]:a}))};return(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Create New Ad"}),!(null==w?void 0:w.phone)&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start",children:[(0,t.jsx)(l.A,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Verification Recommended"}),(0,t.jsxs)("p",{className:"mt-1 text-sm text-yellow-700",children:["Verify your phone number to increase trust and get your ads approved faster."," ",(0,t.jsx)(x(),{href:"/profile",className:"font-medium underline",children:"Verify now"})]})]})]})}),(0,t.jsxs)("form",{onSubmit:J,className:"max-w-2xl space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Ad Image"}),(0,t.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg",children:(0,t.jsx)("div",{className:"space-y-1 text-center",children:j.length>0?(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:j[0],alt:"Preview",className:"mx-auto h-48 w-48 object-cover rounded-lg"}),(0,t.jsx)("button",{type:"button",onClick:()=>{f([]),v([])},className:"absolute top-2 right-2 p-1 bg-white/90 dark:bg-gray-900/90 rounded-full hover:bg-white dark:hover:bg-gray-900 transition-colors",children:(0,t.jsx)(c.A,{className:"w-5 h-5"})})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)(d.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,t.jsxs)("div",{className:"flex text-sm text-gray-600 dark:text-gray-400",children:[(0,t.jsxs)("label",{htmlFor:"image-upload",className:"relative cursor-pointer rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none focus-within:ring-2 focus-within:ring-primary focus-within:ring-offset-2",children:[(0,t.jsx)("span",{children:"Upload a file"}),(0,t.jsx)("input",{id:"image-upload",name:"image-upload",type:"file",className:"sr-only",accept:"image/*",onChange:e=>{let r=Array.from(e.target.files).filter(e=>y.includes(e.type)?!(e.size>0xa00000)||(u.oR.error("".concat(e.name," is too large (max 10MB)")),!1):(u.oR.error("".concat(e.name," is not a supported image type")),!1));r.length&&(f(e=>[...e,...r]),r.forEach(e=>{let r=new FileReader;r.onloadend=()=>{v(e=>[...e,r.result])},r.readAsDataURL(e)}))},multiple:!0})]}),(0,t.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF up to 10MB"})]})})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Title"}),(0,t.jsx)("input",{type:"text",id:"title",name:"title",required:!0,value:S.title,onChange:U,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),(0,t.jsx)("textarea",{id:"description",name:"description",required:!0,rows:4,value:S.description,onChange:U,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Price"}),(0,t.jsx)("input",{type:"number",id:"price",name:"price",required:!0,min:"0",step:"0.01",value:S.price,onChange:U,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"currency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Currency"}),(0,t.jsxs)("select",{id:"currency",name:"currency",required:!0,value:S.currency,onChange:U,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700",children:[(0,t.jsx)("option",{value:"USD",children:"USD"}),(0,t.jsx)("option",{value:"EUR",children:"EUR"}),(0,t.jsx)("option",{value:"GBP",children:"GBP"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"category_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),(0,t.jsxs)("select",{id:"category_id",name:"category_id",required:!0,value:S.category_id,onChange:U,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700",children:[(0,t.jsx)("option",{value:"",children:"Select a category"}),m.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Location"}),(0,t.jsx)("input",{type:"text",id:"location",name:"location",required:!0,value:S.location,onChange:U,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-700"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Condition"}),(0,t.jsxs)("select",{name:"condition",value:S.condition,onChange:U,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg",children:[(0,t.jsx)("option",{value:"new",children:"New"}),(0,t.jsx)("option",{value:"like-new",children:"Like New"}),(0,t.jsx)("option",{value:"good",children:"Good"}),(0,t.jsx)("option",{value:"fair",children:"Fair"}),(0,t.jsx)("option",{value:"poor",children:"Poor"})]})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",id:"negotiable",name:"negotiable",checked:S.negotiable,onChange:e=>A(r=>({...r,negotiable:e.target.checked})),className:"h-4 w-4 text-primary border-gray-300 rounded"}),(0,t.jsx)("label",{htmlFor:"negotiable",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Price is negotiable"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Location on Map"}),(0,t.jsx)("div",{className:"h-[300px] rounded-lg overflow-hidden",children:(0,t.jsx)(p,{onLocationSelect:P})}),k.coordinates&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:k.coordinates})]}),(0,t.jsx)("div",{children:(0,t.jsx)("button",{type:"submit",disabled:a,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Creating...":"Create Ad"})})]})]})}},4785:(e,r,a)=>{"use strict";a.d(r,{A:()=>l,AuthProvider:()=>n});var t=a(5155),s=a(2115);let i=(0,a(851).UU)("https://zvyuurbieuionummrcqi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2eXV1cmJpZXVpb251bW1yY3FpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4NDA0MTIsImV4cCI6MjA1ODQxNjQxMn0.IKZgwRcmGPhYHDuvkRAco9lWk5GXjAT568ZD3XmodEU"),o=(0,s.createContext)();function n(e){let{children:r}=e,[a,n]=(0,s.useState)(null),[l,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let{data:{subscription:e}}=i.auth.onAuthStateChange((e,r)=>{n((null==r?void 0:r.user)||null),c(!1)});return i.auth.getSession().then(e=>{let{data:{session:r}}=e;n((null==r?void 0:r.user)||null),c(!1)}),()=>{null==e||e.unsubscribe()}},[]);let d=async(e,r)=>{let{error:a}=await i.auth.signInWithPassword({email:e,password:r});return{error:a}},u=async(e,r)=>{let{error:a}=await i.auth.signUp({email:e,password:r});return{error:a}},m=async()=>{let{error:e}=await i.auth.signOut();return{error:e}};return(0,t.jsx)(o.Provider,{value:{user:a,loading:l,signIn:d,signUp:u,signOut:m,supabase:i},children:r})}function l(){return(0,s.useContext)(o)}},6463:(e,r,a)=>{Promise.resolve().then(a.bind(a,1263))}},e=>{var r=r=>e(e.s=r);e.O(0,[112,106,441,684,358],()=>r(6463)),_N_E=e.O()}]);